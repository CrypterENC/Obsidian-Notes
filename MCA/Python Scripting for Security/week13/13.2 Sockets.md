# üîå Sockets in Python

## üìñ Overview
- Sockets **enable network communication** between devices.
- `socket` module provides **low-level networking interface**.
- Supports **TCP** (reliable) and **UDP** (fast, unreliable) protocols.

## üè∑Ô∏è Socket Types

| Protocol | Description | Use Case |
|----------|-------------|----------|
| **TCP (SOCK_STREAM)** | Connection-oriented, reliable, ordered data transfer. | Web browsing, file transfer. |
| **UDP (SOCK_DGRAM)** | Connectionless, fast, no guarantee of delivery/order. | Video streaming, DNS queries. |

## üõ†Ô∏è Creating a Socket
```python
import socket

# TCP socket
tcp_sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

# UDP socket
udp_sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
```

## üñ•Ô∏è TCP Server Example
```python
import socket

server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
server.bind(('localhost', 12345))
server.listen(5)

while True:
    client, addr = server.accept()
    print(f"Connected to {addr}")
    data = client.recv(1024)
    client.send(b"Hello from server!")
    client.close()
```

## üíª TCP Client Example
```python
import socket

client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
client.connect(('localhost', 12345))
client.send(b"Hello server!")
response = client.recv(1024)
print(response.decode())
client.close()
```

## üì° UDP Server Example
```python
import socket

server = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
server.bind(('localhost', 12345))

while True:
    data, addr = server.recvfrom(1024)
    print(f"Received from {addr}: {data.decode()}")
    server.sendto(b"Hello from UDP server!", addr)
```

## üì± UDP Client Example
```python
import socket

client = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
client.sendto(b"Hello UDP server!", ('localhost', 12345))
response, addr = client.recvfrom(1024)
print(response.decode())
```

## üìã Common Methods

| Method | Description | TCP/UDP |
|--------|-------------|---------|
| `socket()` | Create socket. | Both |
| `bind(address)` | Bind to address (server). | Both |
| `listen(backlog)` | Listen for connections (TCP server). | TCP |
| `accept()` | Accept connection (TCP server). | TCP |
| `connect(address)` | Connect to server (client). | TCP |
| `send(data)` | Send data. | TCP |
| `recv(buffer)` | Receive data. | TCP |
| `sendto(data, address)` | Send to address. | UDP |
| `recvfrom(buffer)` | Receive from address. | UDP |
| `close()` | Close socket. | Both |

## ÔøΩ Socket Operations

### 1. Socket Creation
- **Server and Client**: Create a socket object using `socket.socket()`.
- Specify address family (e.g., `AF_INET` for IPv4) and socket type (e.g., `SOCK_STREAM` for TCP).
```python
import socket

# TCP socket
sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

# UDP socket
udp_sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
```

### 2. Socket Binding + Listening (Server Only)
- **Binding**: Associate the socket with a specific address and port using `bind()`.
- **Listening**: Put the socket in listening mode to accept incoming connections using `listen()`.
```python
# Bind to localhost on port 12345
server_sock.bind(('localhost', 12345))

# Listen for up to 5 queued connections
server_sock.listen(5)
```

### 3. Socket Accepting (Server Only)
- **Accepting**: Wait for and accept incoming client connections using `accept()`.
- Returns a new socket object for the client and the client's address.
```python
# Accept a connection
client_sock, client_addr = server_sock.accept()
print(f"Accepted connection from {client_addr}")
```

### 4. Sending and Receiving Data

#### For TCP Server
- Use `recv()` to receive data from the client socket.
- Use `send()` to send data back to the client.
```python
# Receive up to 1024 bytes
data = client_sock.recv(1024)
print(f"Received: {data.decode()}")

# Send response
client_sock.send(b"Hello from server!")
```

#### For TCP Client
- Use `send()` to send data to the server.
- Use `recv()` to receive the server's response.
```python
# Send data
client_sock.send(b"Hello server!")

# Receive response
response = client_sock.recv(1024)
print(f"Response: {response.decode()}")
```

#### For UDP (Server and Client)
- Use `recvfrom()` to receive data and the sender's address.
- Use `sendto()` to send data to a specific address.
```python
# Server: Receive
data, addr = server_sock.recvfrom(1024)
print(f"Received from {addr}: {data.decode()}")

# Send back
server_sock.sendto(b"Hello!", addr)

# Client: Send
client_sock.sendto(b"Hello server!", ('localhost', 12345))

# Receive
response, server_addr = client_sock.recvfrom(1024)
print(f"Response: {response.decode()}")
```

## ÔøΩüìù Notes
- Use `with` or **try-except** for error handling.
- For **IPv6**, use `AF_INET6`.
- Sockets are **blocking** by default; use `setblocking(False)` for non-blocking.
- Handle exceptions like `socket.error`, `ConnectionRefusedError`.
- For advanced use, consider `socketserver` module for higher-level abstractions.

## üöÄ Socket User Flow (Coder's Perspective)
Here's how a coder uses sockets in a program, step-by-step for TCP and UDP.

### General Steps
1. **Import socket**: `import socket`
2. **Choose protocol**: TCP or UDP.
3. **Create socket**: `sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)` or `socket.SOCK_DGRAM`.
4. **Handle logic**: Bind/listen/connect, send/receive.
5. **Close socket**: `sock.close()`.
6. **Error handling**: Use try-except.

### TCP Server Flow
1. Create TCP socket.
2. Bind: `sock.bind(('localhost', 12345))`
3. Listen: `sock.listen(5)`
4. Accept in loop: `client, addr = sock.accept()`
5. Receive: `data = client.recv(1024)`
6. Send: `client.send(b'Response')`
7. Close client: `client.close()`

### TCP Client Flow
1. Create TCP socket.
2. Connect: `sock.connect(('server_ip', 12345))`
3. Send: `sock.send(b'Hello')`
4. Receive: `response = sock.recv(1024)`
5. Close socket.

### UDP Server Flow
1. Create UDP socket.
2. Bind: `sock.bind(('localhost', 12345))`
3. Receive in loop: `data, addr = sock.recvfrom(1024)`
4. Send: `sock.sendto(b'Response', addr)`

### UDP Client Flow
1. Create UDP socket.
2. Send: `sock.sendto(b'Hello', ('server_ip', 12345))`
3. Receive: `response, addr = sock.recvfrom(1024)`
4. Close socket.

### üí° Tips
- Blocking by default; use `setblocking(False)` for async.
- Use threads for concurrency.
- Test with separate terminals for server/client.